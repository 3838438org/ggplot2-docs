<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Base ggproto classes for ggplot2 — ggplot2-ggproto • ggplot2</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>

<!-- Bootstrap -->
<link href="../tidyverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- tidyverse -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>

<!-- mathjax -->
<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">ggplot2</a>
        <small class="tidyverse">part of the <a href="http://tidyverse.org">tidyverse</a></small>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
        <li>
  <a href="https://github.com/tidyverse/ggplot2">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Base ggproto classes for ggplot2</h1>
    </div>

    
    <p>If you are creating a new geom, stat, position, or scale in another package,
you'll need to extend from <code>ggplot2::Geom</code>, <code>ggplot2::Stat</code>,
<code>ggplot2::Position</code>, or <code>ggplot2::Scale</code>.</p>
    

        
    <h2 class="hasAnchor" id="geoms"><a class="anchor" href="#geoms"></a>Geoms</h2>

    
    <p>All <code>geom_*</code> functions (like <code>geom_point</code>) return a layer that
contains a <code>Geom*</code> object (like <code>GeomPoint</code>). The <code>Geom*</code></p>
<p>object is responsible for rendering the data in the plot.</p>
<p>Each of the <code>Geom*</code> objects is a <code><a href='ggproto.html'>ggproto</a></code> object, descended
from the top-level <code>Geom</code>, and each implements various methods and
fields. To create a new type of Geom object, you typically will want to
implement one or more of the following:</p>
<p>Compared to <code>Stat</code> and <code>Position</code>, <code>Geom</code> is a little
different because the execution of the setup and compute functions is
split up. <code>setup_data</code> runs before position adjustments, and
<code>draw_layer</code> is not run until render time,  much later. This
means there is no <code>setup_params</code> because it's hard to communicate
the changes.</p>
<ul>
<li>  </li>
<li> Override either <code>draw_panel(self, data, panel_scales, coord)</code> or
    <code>draw_group(self, data, panel_scales, coord)</code>. <code>draw_panel</code> is
    called once per panel, <code>draw_group</code> is called once per group.
    Use <code>draw_panel</code> if each row in the data represents a
    single element. Use <code>draw_group</code> if each group represents
    an element (e.g. a smooth, a violin).
    <code>data</code> is a data frame of scaled aesthetics. <code>panel_scales</code>
    is a list containing information about the scales in the current
    panel. <code>coord</code> is a coordinate specification. You'll
    need to call <code>coord$transform(data, panel_scales)</code> to work
    with non-Cartesian coords. To work with non-linear coordinate systems,
    you typically need to convert into a primitive geom (e.g. point, path
    or polygon), and then pass on to the corresponding draw method
    for munching.
    Must return a grob. Use <code><a href='zeroGrob.html'>zeroGrob</a></code> if there's nothing to
    draw.
  </li>
<li> <code>draw_key</code>: Renders a single legend key.
  </li>
<li> <code>required_aes</code>: A character vector of aesthetics needed to
    render the geom.
  </li>
<li> <code>default_aes</code>: A list (generated by <code><a href='aes.html'>aes</a>()</code> of
    default values for aesthetics.
  </li>
<li> <code>reparameterise</code>: Converts width and height to xmin and xmax,
    and ymin and ymax values. It can potentially set other values as well.
</li>
</ul>
    
    <h2 class="hasAnchor" id="coordinate-systems"><a class="anchor" href="#coordinate-systems"></a>Coordinate systems</h2>

    
    <p>All <code>coord_*</code> functions (like <code>coord_trans</code>) return a <code>Coord*</code></p>
<p>object (like <code>CoordTrans</code>). The <code>Coord*</code> object is responsible for
adjusting the position of overlapping geoms.</p>
<p>The way that the <code>coord_*</code> functions work is slightly different from the
<code>geom_*</code> and <code>stat_*</code> functions, because a <code>coord_*</code> function
actually "instantiates" the <code>Coord*</code> object by creating a descendant,
and returns that.</p>
<p>Each of the <code>Coord*</code> objects is a <code><a href='ggproto.html'>ggproto</a></code> object,
descended from the top-level <code>Coord</code>.  To create a new type of Coord
object, you typically will want to implement one or more of the following:</p>
<ul>
<li>  </li>
<li> <code>aspect</code>: Returns the desired aspect ratio for the plot.
  </li>
<li> <code>labels</code>: Returns a list containing labels for x and y.
  </li>
<li> <code>render_fg</code>: Renders foreground elements.
  </li>
<li> <code>render_bg</code>: Renders background elements.
  </li>
<li> <code>render_axis_h</code>: Renders the horizontal axes.
  </li>
<li> <code>render_axis_v</code>: Renders the vertical axes.
  </li>
<li> <code>range</code>: Returns the x and y ranges
  </li>
<li> <code>train</code>: Return the trained scale ranges.
  </li>
<li> <code>transform</code>: Transforms x and y coordinates.
  </li>
<li> <code>distance</code>: Calculates distance.
  </li>
<li> <code>is_linear</code>: Returns <code>TRUE</code> if the coordinate system is
    linear; <code>FALSE</code> otherwise.
</li>
</ul>
    
    <h2 class="hasAnchor" id="facets"><a class="anchor" href="#facets"></a>Facets</h2>

    
    <p>All <code>facet_*</code> functions returns a <code>Facet</code> object or an object of a
<code>Facet</code> subclass. This object describes how to assign data to different
panels, how to apply positional scales and how to lay out the panels, once
rendered.</p>
<p>Extending facets can range from the simple modifications of current facets,
to very laborious rewrites with a lot of <code>gtable</code> manipulation.
For some examples of both, please see the extension vignette.</p>
<p><code>Facet</code> subclasses, like other extendible ggproto classes, have a range
of methods that can be modified. Some of these are required for all new
subclasses, while other only need to be modified if need arises.</p>
<p>The required methods are:</p>
<ul>
<li>  </li>
<li> <code>compute_layout</code>: Based on layer data compute a mapping between
  panels, axes, and potentially other parameters such as faceting variable
  level etc. This method must return a data.frame containing at least the
  columns <code>PANEL</code>, <code>SCALE_X</code>, and <code>SCALE_Y</code> each containing
  integer keys mapping a PANEL to which axes it should use. In addition the
  data.frame can contain whatever other information is necessary to assign
  observations to the correct panel as well as determining the position of
  the panel.
    </li>
<li> <code>map_data</code>: This method is supplied the data for each layer in
  turn and is expected to supply a <code>PANEL</code> column mapping each row to a
  panel defined in the layout. Additionally this method can also add or
  subtract data points as needed e.g. in the case of adding margins to
  <code>facet_grid</code>.
    </li>
<li> <code>draw_panels</code>: This is where the panels are assembled into a
  <code>gtable</code> object. The method recieves, among others, a list of grobs
  defining the content of each panel as generated by the Geoms and Coord
  objects. The responsibility of the method is to decorate the panels with
  axes and strips as needed, as well as position them relative to each other
  in a gtable. For some of the automatic functions to work correctly, each
  panel, axis, and strip grob name must be prefixed with "panel", "axis", and
  "strip" respectively.
</li>
</ul>
    <p>In addition to the methods described above, it is also possible to override
the default behaviour of one or more of the following methods:</p>
<ul>
<li>  </li>
<li> <code>setup_params</code>:
  </li>
<li> <code>init_scales</code>: Given a master scale for x and y, create panel
  specific scales for each panel defined in the layout. The default is to
  simply clone the master scale.
    </li>
<li> <code>train_scales</code>: Based on layer data train each set of panel
  scales. The default is to train it on the data related to the panel.
    </li>
<li> <code>finish_data</code>: Make last-minute modifications to layer data
  before it is rendered by the Geoms. The default is to not modify it.
    </li>
<li> <code>draw_back</code>: Add a grob in between the background defined by the
  Coord object (usually the axis grid) and the layer stack. The default is to
  return an empty grob for each panel.
    </li>
<li> <code>draw_front</code>: As above except the returned grob is placed
  between the layer stack and the foreground defined by the Coord object
  (usually empty). The default is, as above, to return an empty grob.
    </li>
<li> <code>draw_labels</code>: Given the gtable returned by <code>draw_panels</code>,
  add axis titles to the gtable. The default is to add one title at each side
  depending on the position and existance of axes.
</li>
</ul>
    <p>All extension methods recieve the content of the params field as the params
argument, so the constructor function will generally put all relevant
information into this field. The only exception is the <code>shrink</code></p>
<p>parameter which is used to determine if scales are retrained after Stat
transformations has been applied.</p>
    
    <h2 class="hasAnchor" id="stats"><a class="anchor" href="#stats"></a>Stats</h2>

    
    <p>All <code>stat_*</code> functions (like <code>stat_bin</code>) return a layer that
contains a <code>Stat*</code> object (like <code>StatBin</code>). The <code>Stat*</code></p>
<p>object is responsible for rendering the data in the plot.</p>
<p>Each of the <code>Stat*</code> objects is a <code><a href='ggproto.html'>ggproto</a></code> object, descended
from the top-level <code>Stat</code>, and each implements various methods and
fields. To create a new type of Stat object, you typically will want to
implement one or more of the following:</p>
<ul>
<li>  </li>
<li> Override one of :
    <code>compute_layer(self, data, scales, ...)</code>,
    <code>compute_panel(self, data, scales, ...)</code>, or
    <code>compute_group(self, data, scales, ...)</code>.
    <code>compute_layer()</code> is called once per layer, <code>compute_panel_()</code>
    is called once per panel, and <code>compute_group()</code> is called once per
    group. All must return a data frame.
    It's usually best to start by overriding <code>compute_group</code>: if
    you find substantial performance optimisations, override higher up.
    You'll need to read the source code of the default methods to see
    what else you should be doing.
    <code>data</code> is a data frame containing the variables named according
    to the aesthetics that they're mapped to. <code>scales</code> is a list
    containing the <code>x</code> and <code>y</code> scales. There functions are called
    before the facets are trained, so they are global scales, not local
    to the individual panels.<code>...</code> contains the parameters returned by
    <code>setup_params()</code>.
  </li>
<li> <code>finish_layer(data, params)</code>: called once for each layer. Used
    to modify the data after scales has been applied, but before the data is
    handed of to the geom for rendering. The default is to not modify the
    data. Use this hook if the stat needs access to the actual aesthetic
    values rather than the values that are mapped to the aesthetic.
  </li>
<li> <code>setup_params(data, params)</code>: called once for each layer.
    Used to setup defaults that need to complete dataset, and to inform
    the user of important choices. Should return list of parameters.
  </li>
<li> <code>setup_data(data, params)</code>: called once for each layer,
    after <code>setp_params()</code>. Should return modified <code>data</code>.
    Default methods removes all rows containing a missing value in
    required aesthetics (with a warning if <code>!na.rm</code>).
  </li>
<li> <code>required_aes</code>: A character vector of aesthetics needed to
    render the geom.
  </li>
<li> <code>default_aes</code>: A list (generated by <code><a href='aes.html'>aes</a>()</code> of
    default values for aesthetics.
</li>
</ul>
    
    <h2 class="hasAnchor" id="positions"><a class="anchor" href="#positions"></a>Positions</h2>

    
    <p>All <code>position_*</code> functions (like <code>position_dodge</code>) return a
<code>Position*</code> object (like <code>PositionDodge</code>). The <code>Position*</code></p>
<p>object is responsible for adjusting the position of overlapping geoms.</p>
<p>The way that the <code>position_*</code> functions work is slightly different from
the <code>geom_*</code> and <code>stat_*</code> functions, because a <code>position_*</code></p>
<p>function actually "instantiates" the <code>Position*</code> object by creating a
descendant, and returns that.</p>
<p>Each of the <code>Position*</code> objects is a <code><a href='ggproto.html'>ggproto</a></code> object,
descended from the top-level <code>Position</code>, and each implements the
following methods:</p>
<ul>
<li>  </li>
<li> <code>compute_layer(self, data, params, panel)</code> is called once
    per layer. <code>panel</code> is currently an internal data structure, so
    this method should not be overriden.
    </li>
<li> <code>compute_panel(self, data, params, panel)</code> is called once per
    panel and should return a modified data frame.
    <code>data</code> is a data frame containing the variables named according
    to the aesthetics that they're mapped to. <code>scales</code> is a list
    containing the <code>x</code> and <code>y</code> scales. There functions are called
    before the facets are trained, so they are global scales, not local
    to the individual panels. <code>params</code> contains the parameters returned by
    <code>setup_params()</code>.
  </li>
<li> <code>setup_params(data, params)</code>: called once for each layer.
     Used to setup defaults that need to complete dataset, and to inform
     the user of important choices. Should return list of parameters.
  </li>
<li> <code>setup_data(data, params)</code>: called once for each layer,
     after <code>setp_params()</code>. Should return modified <code>data</code>.
     Default checks that required aesthetics are present.
</li>
</ul>
    <p>And the following fields</p><ul>
<li>  </li>
<li> <code>required_aes</code>: a character vector giving the aesthetics
     that must be present for this position adjustment to work.
</li>
</ul>
    
    <h2 class="hasAnchor" id="scales"><a class="anchor" href="#scales"></a>Scales</h2>

    
    <p>All <code>scale_*</code> functions (like <code>scale_x_continuous</code>) return a
<code>Scale*</code> object (like <code>ScaleContinuous</code>). The <code>Scale*</code></p>
<p>object represents a single scale.</p>
<p>Each of the <code>Scale*</code> objects is a <code><a href='ggproto.html'>ggproto</a></code> object,
descended from the top-level <code>Scale</code>.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p>ggproto</p>
    

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      
      <li><a href="#geoms">Geoms</a></li>

      <li><a href="#coordinate-systems">Coordinate systems</a></li>

      <li><a href="#facets">Facets</a></li>

      <li><a href="#stats">Stats</a></li>

      <li><a href="#positions">Positions</a></li>

      <li><a href="#scales">Scales</a></li>

      <li><a href="#see-also">See also</a></li>
          </ul>

  </div>
</div>

      <footer>
      <div class="tidyverse">
  <p>ggplot2 is a part of the <strong>tidyverse</strong>, an ecosystem of packages designed with common APIs and a shared philosophy. Learn more at <a href="http://tidyverse.org">tidyverse.org</a>.</p>
</div>

<div class="author">
  <p>Developed by <a href='http://hadley.nz'>Hadley Wickham</a>, Winston Chang, <a href='https://www.rstudio.com'><img src='http://tidyverse.org/rstudio-logo.svg' height='24' /></a>.</p>
  <p>Site built by <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-67989-18', 'auto');
  ga('send', 'pageview');
</script>
      </footer>
   </div>

  </body>
</html>
